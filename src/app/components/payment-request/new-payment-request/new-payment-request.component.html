<div class="new-payment-request-container">
  <app-sidebar [sidebarType]="'finance'" [(open)]="sidebarOpen"></app-sidebar>
  
  <div class="main-content">
    <app-header 
      title="PAYMENT REQUEST" 
      subtitle="Finance Services/Payment Request"
      headerClass="finance"
      [showBackButton]="true"
      [(sidebarOpen)]="sidebarOpen">
    </app-header>
    
    <div class="new-payment-request-content">
      <form [formGroup]="paymentRequestForm" (ngSubmit)="onSubmit()" class="form">
        <div class="new-payment-request-section card-effect">
          <div class="section-header">
            <h2>PAYMENT REQUEST</h2>
          </div>
          
          <div class="section-body">
            <!-- Project Details -->
            <div class="form-section">
              <h3>Project Details</h3>
              <div class="form-layout">
                <div class="form-row">
                  <div class="form-group">
                    <label>Document No:</label>
                    <input type="text" formControlName="documentNo" readonly>
                  </div>
                  <div class="form-group">
                    <label>Approved funding No: *</label>
                    <select formControlName="approvedFunding">
                      <option value="">Approved funding No.</option>
                      <option value="AF-001">AF-001 - Medical Supplies</option>
                      <option value="AF-002">AF-002 - Equipment Purchase</option>
                    </select>
                  </div>
                </div>
                
                <div class="form-row">
                  <div class="form-group">
                    <label>Requested Date:</label>
                    <input type="date" formControlName="requestedDate">
                  </div>
                  <div class="form-group">
                    <label>Requested Amount:</label>
                    <input type="number" formControlName="requestedAmount" placeholder="Requested Amount">
                  </div>
                </div>
                
                <div class="form-row">
                  <div class="form-group full-width">
                    <label>Project Code</label>
                    <select formControlName="projectCode">
                      <option value="">Select Project Code</option>
                      <option value="PC-001">PC-001 - Health Initiative</option>
                      <option value="PC-002">PC-002 - Education Program</option>
                    </select>
                  </div>
                </div>
                
                <div class="form-row">
                  <div class="form-group full-width">
                    <label>Description</label>
                    <textarea formControlName="description" placeholder="Description" rows="3"></textarea>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Supporting Documents -->
            <div class="form-section">
              <h3>Supporting Documents</h3>
              <div class="documents-layout">
                <div class="upload-section">
                  <div class="form-row">
                    <div class="form-group">
                      <label>Document Name:</label>
                      <select>
                        <option value="">Cash Request</option>
                        <option value="invoice">Invoice</option>
                        <option value="quotation">Quotation</option>
                        <option value="receipt">Receipt</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label>Upload File</label>
                      <div class="file-upload-row">
                        <input type="text" placeholder="Choose a File..." readonly>
                        <button type="button" class="choose-file-btn" (click)="triggerFileUpload()">Choose File</button>
                      </div>
                    </div>
                  </div>
                  <button type="button" class="upload-btn">UPLOAD</button>
                </div>
              </div>
              
              <!-- Uploaded Documents Table -->
              <div class="uploaded-documents" *ngIf="uploadedDocuments.length > 0">
                <h4>Uploaded Documents</h4>
                <div class="documents-table-container">
                  <table class="documents-table">
                    <thead>
                      <tr>
                        <th>Document Name</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let document of uploadedDocuments; let i = index" [class.striped]="i % 2 === 1">
                        <td>{{ document.name }}</td>
                        <td>
                          <div class="document-actions">
                            <button type="button" class="action-btn view-btn" (click)="viewDocument(document)">
                              <img src="assets/view.svg" alt="View" width="16" height="16" />
                              VIEW
                            </button>
                            <button type="button" class="action-btn delete-btn" (click)="deleteDocument(document.id)">
                              <img src="assets/delete.svg" alt="Delete" width="16" height="16" />
                              DELETE
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <!-- Add New Request Line Button -->
            <button type="button" class="add-new-btn" (click)="openAddLineModal()">
              <img src="assets/Add.svg" alt="Add" width="24" height="24" />
              ADD NEW REQUEST LINE
            </button>
            
            <!-- Payment Request Lines Table -->
            <div class="request-lines-table-container" *ngIf="paymentRequestLines.length > 0">
              <table class="request-lines-table">
                <thead>
                  <tr>
                    <th>No.</th>
                    <th>Document Date</th>
                    <th>Currency</th>
                    <th>Amount</th>
                    <th>Date To</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let line of paymentRequestLines; let i = index" [class.striped]="i % 2 === 1">
                    <td>AR_{{ (i + 31).toString().padStart(4, '0') }}</td>
                    <td>10/5/2025</td>
                    <td>{{ line.currencyCode }}.</td>
                    <td>{{ line.amount | currency:'KSH':'symbol':'1.0-0' }}</td>
                    <td>20/5/2025</td>
                    <td>{{ line.description }}</td>
                    <td>Open</td>
                    <td>
                      <div class="line-actions">
                        <button type="button" class="action-btn delete-btn" (click)="deleteLine(line.id)">
                          <img src="assets/delete.svg" alt="Delete" width="16" height="16" />
                          DELETE
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Form Actions -->
          <div class="section-footer">
            <button type="submit" class="btn btn-primary">submit</button>
            <button type="button" class="btn btn-secondary" (click)="onCancel()">Cancel</button>
          </div>
        </div>
      </form>
    </div>
    
    <app-footer></app-footer>
  </div>
</div>

<!-- Add/Edit Payment Request Line Modal -->
<div class="modal-overlay" *ngIf="showAddLineModal" (click)="closeAddLineModal()">
  <div class="modal-content add-line-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Payment Request Line</h2>
    </div>
    
    <form [formGroup]="paymentRequestLineForm">
      <div class="modal-body">
        <div class="form-section">
          <h3>Request Details</h3>
          <div class="form-row">
            <div class="form-group">
              <label>Currency Code</label>
              <select formControlName="currencyCode">
                <option value="">Currency Code</option>
                <option *ngFor="let currency of currencyOptions" [value]="currency.code">
                  {{ currency.code }} - {{ currency.name }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label>Amount</label>
              <input type="number" formControlName="amount" placeholder="0">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group full-width">
              <label>Description</label>
              <textarea formControlName="description" placeholder="Description" rows="4"></textarea>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="submitLine()">
          {{ isEditMode ? 'Update' : 'Add line' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="closeAddLineModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>